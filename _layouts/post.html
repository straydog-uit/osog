---
layout: default
---

<article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">{{ page.title | escape }} </h1>
    <p class="post-meta">
      <time class="dt-published" datetime="{{ page.date | date_to_xmlschema }}" itemprop="datePublished">
        {%- assign date_format = site.minima.date_format | default: "%b %-d, %Y" -%}
        {{ page.date | date: date_format }}
      </time>
      {%- if page.author -%}
      â€¢ <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-author h-card"
          itemprop="name">{{ page.author }}</span></span>
      {%- endif -%}
    </p>
  </header>

  {{ content }}

  <div id="save-box" style="display:none;">
    <button id="save-btn" data-url="{{ page.url | relative_url }}" style="background:none;border:none;cursor:pointer;">
      <i class="fa-regular fa-bookmark"></i>
    </button>
  </div>
</article>

<script>
  const saveBox = document.getElementById('save-box');
  const btn = document.getElementById('save-btn');
  const icon = btn?.querySelector('i');
  const postUrl = btn?.dataset.url;
  const postTitle = document.querySelector('.post-title')?.textContent?.trim() || postUrl;

  function setIcon(saved) {
    if (!icon) return;
    icon.classList.toggle('fa-regular', !saved);
    icon.classList.toggle('fa-solid', saved);
  }

  btn?.addEventListener('click', (e) => {
    e.preventDefault();
    fetch('/api/bookmark.php', {
      method: 'POST',
      credentials: 'include',
      headers: {'Content-Type': 'application/x-www-form-urlencoded'},
      body: `post=${encodeURIComponent(postUrl)}&title=${encodeURIComponent(postTitle)}`

    })
      .then(r => r.json())
      .then(d => {if (d.ok) setIcon(d.saved);})
      .catch(err => console.error('bookmark error', err));
  });

  fetch('/api/auth_status.php', {credentials: 'include', cache: 'no-store'})
    .then(r => r.json())
    .then(auth => {
      if (!auth.logged_in) return;
      saveBox.style.display = 'block';
      fetch(`/api/check_bookmark.php?post=${encodeURIComponent(postUrl)}`, {credentials: 'include', cache: 'no-store'})
        .then(r => r.json())
        .then(d => setIcon(d.saved))
        .catch(err => console.error('check_bookmark error', err));
    });

</script>